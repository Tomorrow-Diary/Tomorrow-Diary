<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.tomorrowdiray_backend.user.repository.UserRepository">

    <!-- ResultMap 정의 -->
    <resultMap id="userResultMap" type="com.ssafy.tomorrowdiray_backend.user.entity.User">
        <id property="id" column="id" />
        <result property="socialId" column="social_id" />
        <result property="nickname" column="nickname" />
        <result property="startTime" column="start_time" />
        <result property="endTime" column="end_time" />
        <result property="role" column="role" />
        <result property="transportTypeId" column="transport_type_id" />
        <result property="usersDestinationId" column="users_destination_id" />
    </resultMap>

    <insert id="insert">
        INSERT INTO users (
            social_id,
            nickname,
            start_time,
            end_time,
            transport_type_id,
            users_destination_id
        ) VALUES (
            #{socialId},
            #{nickname},
            #{startTime},
            #{endTime},
            #{transportTypeId},
            #{usersDestinationId}
        )
    </insert>

    <insert id="insertDestination" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO users_destination (
            destination_address,
            latitude,
            longitude
        ) VALUES (
            #{destinationAddress},
            #{latitude},
            #{longitude}
        )
    </insert>

    <select id="findBySocialUser" resultType="User" parameterType="SocialUser">
        select * from users where social_id=#{socialId} and nickname=#{nickname}
    </select>

</mapper>
